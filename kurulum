1ï¸âƒ£ ArduPilot SITL Kurulumu

SITL (Software In The Loop), uÃ§uÅŸ kontrol yazÄ±lÄ±mÄ±nÄ± fiziksel drone olmadan bilgisayarda Ã§alÄ±ÅŸtÄ±rmamÄ±zÄ± saÄŸlar.

Repo:
ArduPilot
1.1 Gerekli Paketler
sudo apt update
sudo apt install git gitk git-gui -y

1.2 Kaynak Kodun Ä°ndirilmesi
cd ~
git clone https://github.com/ArduPilot/ardupilot.git
cd ardupilot
git submodule update --init --recursive

1.3 BaÄŸÄ±mlÄ±lÄ±klarÄ±n KurulmasÄ±
cd ~/ardupilot
Tools/environment_install/install-prereqs-ubuntu.sh -y
. ~/.profile

âš ï¸ Oturumu kapatÄ±p tekrar aÃ§man Ã¶nerilir.
1.4 SITL Derleme
Copter
cd ~/ardupilot
./waf configure --board sitl
./waf copter
Plane
./waf configure --board sitl
./waf plane

2ï¸âƒ£ Gazebo 11 Kurulumu

SimÃ¼lasyon motoru:
Gazebo

2.1 Repository Eklenmesi
sudo sh -c 'echo "deb http://packages.osrfoundation.org/gazebo/ubuntu-stable $(lsb_release -cs) main" > /etc/apt/sources.list.d/gazebo-stable.list'
2.2 Anahtar Eklenmesi
wget https://packages.osrfoundation.org/gazebo.key -O - | sudo apt-key add -
2.3 Kurulum
sudo apt update
sudo apt install gazebo11 libgazebo11-dev -y

Test:

gazebo
3ï¸âƒ£ Gazebo ArduPilot Plugin Kurulumu

âš ï¸ Copter ve Plane plugin aynÄ± anda kurulmaz.

3.1 Copter Plugin

Repo:
khancyr/ardupilot_gazebo

cd ~
git clone https://github.com/khancyr/ardupilot_gazebo.git
cd ardupilot_gazebo
mkdir build && cd build
cmake ..
make -j4
sudo make install

Bashrc ekle:

echo "source /usr/share/gazebo/setup.sh" >> ~/.bashrc
echo "export GAZEBO_MODEL_PATH=~/ardupilot_gazebo/models" >> ~/.bashrc
export GAZEBO_PLUGIN_PATH=~/ardupilot_gazebo/build:${GAZEBO_PLUGIN_PATH}
source ~/.bashrc
3.2 Plane Plugin

Repo:
Softivation/ardupilot_gazebo

cd ~
git clone https://github.com/Softivation/ardupilot_gazebo.git
cd ardupilot_gazebo
mkdir build && cd build
cmake ..
make -j4
sudo make install

Bashrc:

echo "export GAZEBO_MODEL_PATH=~/ardupilot_gazebo/models:${GAZEBO_MODEL_PATH}" >> ~/.bashrc
echo "export GAZEBO_RESOURCE_PATH=~/ardupilot_gazebo/worlds:${GAZEBO_RESOURCE_PATH}" >> ~/.bashrc
echo "export GAZEBO_PLUGIN_PATH=~/ardupilot_gazebo/build:${GAZEBO_PLUGIN_PATH}" >> ~/.bashrc
source ~/.bashrc

4ï¸âƒ£ ROS Noetic Kurulumu

SÃ¼rÃ¼m:
ROS Noetic

sudo sh -c 'echo "deb http://packages.ros.org/ros/ubuntu $(lsb_release -sc) main" > /etc/apt/sources.list.d/ros-latest.list'

sudo apt install curl -y
curl -s https://raw.githubusercontent.com/ros/rosdistro/master/ros.asc | sudo apt-key add -

sudo apt update
sudo apt install ros-noetic-desktop-full -y
Ortam DeÄŸiÅŸkeni
echo "source /opt/ros/noetic/setup.bash" >> ~/.bashrc
echo "source ~/catkin_ws/devel/setup.bash" >> ~/.bashrc
source ~/.bashrc
5ï¸âƒ£ Catkin Workspace

sudo apt install python3-rosdep python3-rosinstall python3-wstool python3-catkin-tools -y

sudo rosdep init
rosdep update

mkdir -p ~/catkin_ws/src
cd ~/catkin_ws
catkin init
6ï¸âƒ£ MAVROS Kurulumu

MAVROS

cd ~/catkin_ws/src
git clone https://github.com/mavlink/mavros.git
git clone https://github.com/mavlink/mavlink.git

cd ~/catkin_ws
rosdep install --from-paths src --ignore-src --rosdistro noetic -y
catkin build

Geographiclib:

sudo ~/catkin_ws/src/mavros/mavros/scripts/install_geographiclib_datasets.sh
7ï¸âƒ£ iq_sim Kurulumu

cd ~/catkin_ws/src
git clone https://github.com/Softivation/iq_sim.git

echo "GAZEBO_MODEL_PATH=${GAZEBO_MODEL_PATH}:$HOME/catkin_ws/src/iq_sim/models" >> ~/.bashrc
echo "export GAZEBO_RESOURCE_PATH=$HOME/catkin_ws/src/iq_sim/worlds:${GAZEBO_RESOURCE_PATH}" >> ~/.bashrc

cd ~/catkin_ws
catkin build
source ~/.bashrc

8ï¸âƒ£ SimÃ¼lasyon Ã‡alÄ±ÅŸtÄ±rma
ğŸš Copter

Terminal 1:

roslaunch iq_sim runway.launch

Terminal 2:

cd ~/ardupilot/Tools/autotest
sim_vehicle.py -v ArduCopter -f gazebo-iris --console
âœˆï¸ Plane

Terminal 1:

roslaunch iq_sim plane_cam.launch

Terminal 2:

sim_vehicle.py -v ArduPlane -f gazebo-zephyr --map --console
ğŸ›© VTOL

vehicleinfo.py iÃ§ine ekle:

"gazebo-quadplane": {
    "waf_target": "bin/arduplane",
    "default_params_filename": "default_params/gazebo_quadplane.parm",
},

Param dosyasÄ±nÄ±:

ardupilot/Tools/autotest/default_params/gazebo_quadplane.parm

klasÃ¶rÃ¼ne koy.

Ã‡alÄ±ÅŸtÄ±r:

Terminal 1:

roslaunch iq_sim vtol.launch

Terminal 2:

sim_vehicle.py -v ArduPlane -f gazebo-quadplane --console
9ï¸âƒ£ Kamera ROS Node

import rospy
from sensor_msgs.msg import Image

def callback(data):
    rospy.loginfo("Image received")

rospy.init_node('image_listener')
rospy.Subscriber('/webcam/image_raw', Image, callback)
rospy.spin()

ğŸ”Ÿ OpenCV GÃ¶rÃ¼ntÃ¼
import rospy
import cv2
from cv_bridge import CvBridge
from sensor_msgs.msg import Image

bridge = CvBridge()

def callback(data):
    img = bridge.imgmsg_to_cv2(data, "bgr8")
    cv2.imshow("Camera", img)
    cv2.waitKey(1)

rospy.init_node('opencv_view')
rospy.Subscriber('/webcam/image_raw', Image, callback)
rospy.spin()
